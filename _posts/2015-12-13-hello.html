---
layout: post
title: I Wish I Had Met Docker Before
date: '2015-12-13T04:41:00.001-08:00'
author: Ivan
tags:
- OTHER
modified_time: '2015-12-18T17:25:14.921-08:00'
blogger_id: tag:blogger.com,1999:blog-415098333644749081.post-2499395070133616141
blogger_orig_url: http://invictuscode.blogspot.com/2015/12/hello.html
---

I started to dig into Docker few days ago, and it totally blew my mind. It make building system environments and deploying server a lot more easier than not using it. Since I worked on backend server development few years ago, I spent most of my time on building server environment and deploying server. Also, configuring server sometimes could be extremely painful because there are different kinds of OS you have to deal with. For example, if it’s on Windows, you have to use configuration for Windows. If it’s on Linux, you have to use configuration for Linux. Event you finished writing those scripts, configuration files or property files to make the process, you still have to switch and adjust them if needed. Docker can make those things easier. For now, I only use Docker to build images and run them on container, but I believe I’m gonna use it for more advanced uses.<br />Before you started to dive into wonderful Docker world, you can check on offical docs to understand what exactly Docker is. It’s easier for you to use it, and it’s very detailed. <br /><a href="https://docs.docker.com/mac/step_two/">https://docs.docker.com/mac/step_two/</a><br /><hr /><h2 id="install-docker">Install Docker</h2><h3 id="ubuntu">Ubuntu</h3><pre class="prettyprint"><code class="language-bash hljs "><span class="hljs-built_in">sudo</span> apt-key adv --keyserver hkp://pgp.mit.edu:<span class="hljs-number">80</span> --<br />    recv-keys <span class="hljs-number">58118</span>E89F3A912897C070ADBF76221572C52609D<br /><span class="hljs-built_in">sudo</span> add-apt-repository <span class="hljs-string">"deb https://apt.dockerproject.org/repo ubuntu-<span class="hljs-variable">$(lsb_release -s -c)</span> main"</span><br /><span class="hljs-built_in">sudo</span> apt-get update<br /><span class="hljs-built_in">sudo</span> apt-get install docker-engine</code></pre><h3 id="mac-or-windows">Mac Or Windows</h3>Download it from the website and install it.  <br /><a href="https://www.docker.com/docker-toolbox">https://www.docker.com/docker-toolbox</a> <br /><h2 id="test-docker-installation">Test Docker Installation</h2><h3 id="check-installed-version">Check installed version</h3><pre class="prettyprint"><code class="language-bash hljs ">docker -v</code></pre><h3 id="run-sample">Run Sample</h3><pre class="prettyprint"><code class="language-bash hljs ">docker run Hello-world</code></pre>“docker run” runs a image on docker<br /><h2 id="some-constantly-used-commands">Some constantly used commands</h2><h3 id="see-docker-process">See Docker process</h3><pre class="prettyprint"><code class="language-bash hljs ">docker ps <span class="hljs-operator">-a</span></code></pre><h3 id="check-docker-images">Check Docker images</h3><pre class="prettyprint"><code class="language-bash hljs ">docker images</code></pre><h3 id="remove-docker-images">Remove Docker images</h3><pre class="prettyprint"><code class="language-bash hljs ">docker rmi <span class="hljs-number">2</span>e8</code></pre>2e8 is image id in docker process. Also, you can use image name + tag.<br /><h3 id="stop-docker-process">Stop Docker process</h3><pre class="prettyprint"><code class="language-bash hljs ">docker stop <span class="hljs-number">2</span>e8</code></pre><h3 id="stop-and-remove-all-containers-and-images">Stop and remove all containers and images</h3>if you’re tired of stoping and removing all containers and images one by one, here’s the command to stop and remove all of them.<br /><pre class="prettyprint"><code class="language-bash hljs ">docker stop $(docker ps  <span class="hljs-operator">-a</span> -q)<br />docker rm $(docker ps <span class="hljs-operator">-a</span> -q)</code></pre><h3 id="dockerfile">Dockerfile</h3>Create a dockerfile to build your own image <br />tomcat7:jdk7 is image name + tag.<br /><pre class="prettyprint"><code class="language-bash hljs ">docker build -t tomcat7:jdk7 .</code></pre><h3 id="dockerfile-example">Dockerfile Example</h3>This example shows you how to write a dockefile to make a tomcat image<br /><pre class="prettyprint"><code class="language-bash hljs ">FROM sshd:ubuntu<br /><br />MAINTAINER Ivan.W from -----<br /><br /><span class="hljs-comment">#ENV DEBIAN_FRONTEND noninteractive</span><br /><br />RUN <span class="hljs-built_in">echo</span> <span class="hljs-string">"Asia/Taipei"</span> &gt;/etc/timezone &amp;&amp; \dpkg-reconfigure <span class="hljs-operator">-f</span> noninteractive tzdata<br /><br />RUN apt-get install -yq --no-install-recommends wget pwgen ca-certificates &amp;&amp; \<br />    apt-get clean &amp;&amp; \<br />    rm -rf /var/lib/apt/lists/*<br /><br />ENV CATALINA_HOME /tomcat<br />ENV JAVA_HOME /jdk<br />ENV JRE_HOME /jdk<br /><br />ADD apache-tomcat-<span class="hljs-number">7.0</span>.<span class="hljs-number">47</span> /tomcat<br />ADD jdk /jdk<br /><br />ADD run.sh /run.sh<br />RUN chmod +x /*.sh<br />RUN chmod +x /tomcat/bin/*.sh<br /><br />VOLUME [<span class="hljs-string">"/opt/webapps"</span>, <span class="hljs-string">"apache-tomcat-7.0.47/webapps"</span>]<br /><br />EXPOSE <span class="hljs-number">8080</span><br />CMD [<span class="hljs-string">"/run.sh"</span>]<br /></code></pre><h3 id="enable-docker-compose-command">Enable docker-compose command</h3><pre class="prettyprint"><code class="language-bash hljs "><span class="hljs-built_in">sudo</span> curl -L https://github.com/docker/compose/releases/download/<span class="hljs-number">1.4</span>.<span class="hljs-number">2</span>/docker-compose-`uname <span class="hljs-operator">-s</span>`-`uname -m` &gt; /usr/local/bin/docker-compose<br /><span class="hljs-built_in">sudo</span> chmod +x /usr/local/bin/docker-compose</code></pre><h3 id="what-is-docker-compose">What is docker-compose</h3>“docker-compose” allows you to run different images on different containers all at once, what’s more, you can define environment variables, links, volumes, and many other things inside a yml file, and run docker-compose with this yml file.<br /><h3 id="docker-compose-file-example">Docker Compose File Example</h3>compose.yml<br /><pre class="prettyprint"><code class="language-bash hljs ">tomcat:<br />  container_name: tomcat<br />  image: tomcat7:jdk7<br />  links:<br />    - db<br />  volumes:<br />    - /opt/webapps:/tomcat/webapps<br />  ports:<br />    - <span class="hljs-string">"8080:8080"</span><br />    - <span class="hljs-string">"9002:22"</span><br />db:<br />  container_name: db<br />  image: mysql:<span class="hljs-number">5.6</span><br />  volumes:<br />    - /opt/mysqldb:/var/lib/mysql<br />  ports:<br />    - <span class="hljs-string">"9006:3006"</span><br />    - <span class="hljs-string">"9003:22"</span></code></pre>“image” assign the base image that you want to put in container and run it with docker-compose.<br />“volumes” allows you to link your machines’ directories to the directories of your containers. The front directory params is your local directory path, and the back directory params is the directory path inside your container. <br />“ports” can link your local ports to the ports in containers.<br />“links” is a way to link containers and let containers connect with each other.<br /><h3 id="run-docker-compose">Run Docker-Compose</h3><pre class="prettyprint"><code class="language-bash hljs ">docker-compose <span class="hljs-operator">-f</span> compose.yml up <span class="hljs-operator">-d</span></code></pre>-f : use yml file to run docker-compose <br />-d : run in background<br />Using docker-compose, you can directly run many containers all at once without typing complex command of “run”, and the advantage is that yml file is easier to read when you want to maintain your containers. <br /><h3 id="stop-docker-compose">Stop Docker-Compose</h3><pre class="prettyprint"><code class="language-bash hljs ">docker-compose <span class="hljs-operator">-f</span> compose.yml stop</code></pre>